<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Methods | Order book events reconstruction from empirical data</title>
  <meta name="description" content="2 Methods | Order book events reconstruction from empirical data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Methods | Order book events reconstruction from empirical data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Methods | Order book events reconstruction from empirical data" />
  
  
  

<meta name="author" content="Petr Fedorov" />


<meta name="date" content="2021-03-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="results.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#continuous-time-double-auction-and-lob"><i class="fa fa-check"></i><b>1.1</b> Continuous-time double auction and LOB</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#available-data-sets"><i class="fa fa-check"></i><b>1.2</b> Available data sets</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>2</b> Methods</a><ul>
<li class="chapter" data-level="2.1" data-path="methods.html"><a href="methods.html#definitions"><i class="fa fa-check"></i><b>2.1</b> Definitions</a><ul>
<li class="chapter" data-level="2.1.1" data-path="methods.html"><a href="methods.html#order-event"><i class="fa fa-check"></i><b>2.1.1</b> Order event</a></li>
<li class="chapter" data-level="2.1.2" data-path="methods.html"><a href="methods.html#stripe-and-dot"><i class="fa fa-check"></i><b>2.1.2</b> Stripe and Dot</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="methods.html"><a href="methods.html#software"><i class="fa fa-check"></i><b>2.2</b> Software</a><ul>
<li class="chapter" data-level="2.2.1" data-path="methods.html"><a href="methods.html#capture-order-events"><i class="fa fa-check"></i><b>2.2.1</b> Capture order events</a><ul>
<li class="chapter" data-level="2.2.1.1" data-path="methods.html"><a href="methods.html#receive-messages"><i class="fa fa-check"></i><b>2.2.1.1</b> Receive messages</a></li>
<li class="chapter" data-level="2.2.1.2" data-path="methods.html"><a href="methods.html#reconstruct-order-book"><i class="fa fa-check"></i><b>2.2.1.2</b> Reconstruct Order Book</a></li>
<li class="chapter" data-level="2.2.1.3" data-path="methods.html"><a href="methods.html#save-output"><i class="fa fa-check"></i><b>2.2.1.3</b> Save output</a></li>
</ul></li>
<li class="chapter" data-level="2.2.2" data-path="methods.html"><a href="methods.html#slice-and-merge-era-files"><i class="fa fa-check"></i><b>2.2.2</b> Slice and merge era files</a></li>
<li class="chapter" data-level="2.2.3" data-path="methods.html"><a href="methods.html#transmute"><i class="fa fa-check"></i><b>2.2.3</b> Transmute</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>3</b> Results</a><ul>
<li class="chapter" data-level="3.1" data-path="results.html"><a href="results.html#fragments-of-extracted-events"><i class="fa fa-check"></i><b>3.1</b> Fragments of extracted events</a><ul>
<li class="chapter" data-level="3.1.1" data-path="results.html"><a href="results.html#coinbase"><i class="fa fa-check"></i><b>3.1.1</b> Coinbase</a></li>
<li class="chapter" data-level="3.1.2" data-path="results.html"><a href="results.html#bitstamp"><i class="fa fa-check"></i><b>3.1.2</b> Bitstamp</a></li>
<li class="chapter" data-level="3.1.3" data-path="results.html"><a href="results.html#bitfinex"><i class="fa fa-check"></i><b>3.1.3</b> Bitfinex</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="results.html"><a href="results.html#fragments-of-cleansed-data"><i class="fa fa-check"></i><b>3.2</b> Fragments of cleansed data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="results.html"><a href="results.html#bitstamp-1"><i class="fa fa-check"></i><b>3.2.1</b> Bitstamp</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>4</b> Discussion</a></li>
<li class="chapter" data-level="5" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>5</b> Appendix</a><ul>
<li class="chapter" data-level="5.1" data-path="appendix.html"><a href="appendix.html#examples-of-order-tables-and-restored-functions"><i class="fa fa-check"></i><b>5.1</b> Examples of order tables and restored functions</a></li>
<li class="chapter" data-level="5.2" data-path="appendix.html"><a href="appendix.html#example-of-lob"><i class="fa fa-check"></i><b>5.2</b> Example of LOB</a></li>
<li class="chapter" data-level="5.3" data-path="appendix.html"><a href="appendix.html#token-handlers"><i class="fa fa-check"></i><b>5.3</b> Token handlers</a><ul>
<li class="chapter" data-level="5.3.1" data-path="appendix.html"><a href="appendix.html#synchronizer"><i class="fa fa-check"></i><b>5.3.1</b> Synchronizer</a></li>
<li class="chapter" data-level="5.3.2" data-path="appendix.html"><a href="appendix.html#timeorderenforcer"><i class="fa fa-check"></i><b>5.3.2</b> TimeOrderEnforcer</a></li>
<li class="chapter" data-level="5.3.3" data-path="appendix.html"><a href="appendix.html#deduplicator"><i class="fa fa-check"></i><b>5.3.3</b> Deduplicator</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Order book events reconstruction from empirical data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="methods" class="section level1">
<h1><span class="header-section-number">2</span> Methods</h1>
<p>We defined the terms “order event and”reconstruction&quot; strictly, developed a software that reconstructs order events in accordance with these definitions from data provided by several cryptocurrency exchanges and analysed whether the exchanges provide enough information for the comprehensive reconstruction of their order book evolution.</p>
<p>Surprisingly, an order, an order event, a limit order book, the operations of a continuous double auction are rather complicated things if one attempts to define them rigorously. Consider, for example, a definition given in the book <span class="citation">(Bouchaud and Bonart 2018)</span>:</p>
<blockquote>
<p>An order is a commitment, declared at a given submission time, to buy or sell a given volume of an asset at no worse than a given price. An order <span class="math inline">\(x\)</span> is thus described by four attributes:</p>
<ul>
<li>its sign (or direction) <span class="math inline">\(\epsilon = \pm 1\)</span>, (<span class="math inline">\(\epsilon_x = +1\)</span> for buy orders; <span class="math inline">\(\epsilon_x = −1\)</span> for sell orders),</li>
<li>its price <span class="math inline">\(p_x\)</span> ,</li>
<li>its volume <span class="math inline">\(v_x &gt; 0\)</span>, and</li>
<li>its submission time <span class="math inline">\(t_x\)</span>.</li>
</ul>
<p>We introduce the succinct notation <span class="math inline">\(x := (\epsilon_x , p_x ,v_x, t_x )\)</span>.</p>
</blockquote>
<p><span class="citation">(Bouchaud and Bonart 2018)</span> then continues with a description of what they call The Trade-Matching Algorithm:</p>
<blockquote>
<p>Whenever a trader submits a buy (respectively, sell) order <span class="math inline">\(x\)</span>, an LOB’s <em>trade-matching algorithm</em> checks whether it is possible for <span class="math inline">\(x\)</span> to match to existing sell (respectively,buy)orders <span class="math inline">\(y\)</span> such that <span class="math inline">\(p_y \leq p_x\)</span> (respectively, <span class="math inline">\(p_y \geq p_x\)</span>). If so, the matching occurs immediately and the relevant traders perform a trade for the agreed amount at the agreed price. Any portion of <span class="math inline">\(x\)</span> that does not match instead becomes active at the price <span class="math inline">\(p_x\)</span>, and it remains active until either it matches to an incoming sell (respectively, buy) order or it is cancelled. Cancellation usually occurs when the owner of an order no longer wishes to offer a trade at the stated price.</p>
</blockquote>
<p>The above definition and description are incomplete:</p>
<ul>
<li><p>According to the definition, an order <span class="math inline">\(x\)</span> seems to be an immutable entity. But according to the Trade-Matching algorithm, a portion of <span class="math inline">\(x\)</span> may become ‘active’ and it is not clear how the quality of being ‘active’ is different from the mere existence of submitted orders,</p></li>
<li><p>At what price the trade is performed - <span class="math inline">\(p_x\)</span> or <span class="math inline">\(p_y\)</span> - is not explicitly stated,</p></li>
<li><p>It is not stated what will happen if <span class="math inline">\(v_x \leq v_y\)</span>, etc.</p></li>
</ul>
<p>Below we propose stricter definitions that address these and the other similar issues trying to stay close to <span class="citation">(Bouchaud and Bonart 2018)</span>. Afterwards we describe the reconstruction process.</p>
<div id="definitions" class="section level2">
<h2><span class="header-section-number">2.1</span> Definitions</h2>
<div id="order-event" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Order event</h3>

<div class="definition">
<p><span id="def:order" class="definition"><strong>Definition 2.1  (Order Function)  </strong></span>
A function <span class="math inline">\(o : \mathbb{R}_{&gt;0} \times \mathbb{R} \mapsto \mathbb{R}\)</span> is called a limit <em>order function</em> if it can be written as
<span class="math display">\[ 
  o(p,t) = \sum_{k=1}^K v_k \mathbf{1}_{P_k \times T_k}(p,t)
\]</span>
where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(\mathcal{T} = \{T_k\}_{k=1}^{K}\)</span> is a partition of left-open finite or right-unbounded interval of <span class="math inline">\(\mathbb{R}\)</span> into intervals with endpoints <span class="math inline">\(t_{k,1} \in \mathbb{R}\)</span>, <span class="math inline">\(t_{k,2} \in \mathbb{R} \cup \{+\infty\}\)</span> such that:
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\forall k \leq K : t_{k,1},t_{k,2} \in \{n \tau : n \in \mathbb{Z}\}\)</span>, where <span class="math inline">\(\tau \in \mathbb{R}_{&gt;0}\)</span> is a constant called <em>sampling interval</em></li>
<li><span class="math inline">\(\forall k &lt; K : t_{k,1} \leq t_{k+1,1} \land t_{k,2} &lt; t_{k+1,2}\)</span></li>
</ol></li>
<li><span class="math inline">\(\mathcal{P} = \{P_k\}_{k=1}^{K}\)</span> is a set of degenerate intervals <span class="math inline">\(P_k = \{p_k\}\)</span> with endpoints <span class="math inline">\(p_k \in \mathbb{R}_{&gt; 0}\)</span>, such that:
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\forall k: p_k \in \{ n \pi : n \in \mathbb{N} \}\)</span> where <span class="math inline">\(\pi \in \mathbb{R}_{&gt;0}\)</span> is a constant called <em>quote increment</em> or <em>tick size</em>,</li>
<li><span class="math inline">\(\forall k &lt; K\)</span> if <span class="math inline">\(t_{k,2} \not \in T_k\)</span> then <span class="math inline">\(p_{k+1} = p_k\)</span></li>
</ol></li>
<li><span class="math inline">\(\mathcal{V} = \{v_k \}_{k=1}^K\)</span> is a set of constants <span class="math inline">\(v_k \in \mathbb{R}_{\neq 0}\)</span> called <em>order volumes</em> such that:
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\forall k\)</span> either <span class="math inline">\(v_k \in \mathbb{R}_{&gt; 0}\)</span> (buy order) or <span class="math inline">\(v_k \in \mathbb{R}_{&lt; 0}\)</span> (sell order),</li>
<li><span class="math inline">\(|v_k| \in \{ n \phi : n \in \mathbb{N}\}\)</span> where <span class="math inline">\(\phi \in \mathbb{R}_{&gt;0}\)</span> is a constant called <em>base increment</em> or <em>lot size</em>,</li>
</ol></li>
<li><span class="math inline">\(\mathbf{1}_{P_k \times T_k}(p, t)\)</span> is an indicator function of the set <span class="math inline">\({P_k \times T_k}\)</span>:
<span class="math display">\[
\mathbf{1}_{P_k \times T_k}(p,t) = \begin{cases} 1, &amp; (p,t) \in P_k \times T_k \\ 0, &amp; (p,t) \not \in P_k \times T_k  \end{cases}
\]</span>
</div></li>
</ol>
<p>The sample interval <span class="math inline">\(\tau\)</span>, quote increment <span class="math inline">\(\pi\)</span> and base increment <span class="math inline">\(\phi\)</span> are collectively called <em>resolution parameters</em>.</p>

<div class="definition">
<span id="def:price-function" class="definition"><strong>Definition 2.2  (Price Function)  </strong></span>Suppose an order function <span class="math inline">\(o(p,t)\)</span> as defined by <a href="methods.html#def:order">2.1</a> is given. A function of time <span class="math display">\[p(t) \equiv \arg\!\max_p |o(p,t)|\]</span>
is called a <em>price function</em>.
</div>


<div class="definition">
<span id="def:volume-function" class="definition"><strong>Definition 2.3  (Volume Function)  </strong></span>Suppose an order function <span class="math inline">\(o(p,t)\)</span> as defined by <a href="methods.html#def:order">2.1</a> and related price function <span class="math inline">\(p(t)\)</span> as defined by <a href="methods.html#def:price-function">2.2</a> are given. A function of time <span class="math display">\[v(t) \equiv o(p(t),t)\]</span> is called a <em>volume function</em>.
</div>


<div class="definition">
<p><span id="def:filled-volume" class="definition"><strong>Definition 2.4  (Filled Volume)  </strong></span>Suppose a volume function <span class="math inline">\(v(t)\)</span> as defined by <a href="methods.html#def:volume-function">2.3</a> is given. The function
<span class="math display">\[
  f_{v}(t) = v(t) - \lim_{t^{&#39;} \uparrow t} v(t^{&#39;}) 
  \]</span> is called a <em>filled volume</em> at time <span class="math inline">\(t\)</span>.</p>
</div>

<p><span class="math inline">\(f_{v}(t) \neq 0\)</span> implies that there is a right-open interval <span class="math inline">\(T_k\)</span> such that its right endpoint equals to <span class="math inline">\(t\)</span>.</p>

<div class="definition">
<p><span id="def:amended-volume" class="definition"><strong>Definition 2.5  (Amended Volume)  </strong></span>Suppose a volume function <span class="math inline">\(v(t)\)</span> as defined by <a href="methods.html#def:volume-function">2.3</a> is given. The function
<span class="math display">\[
  a_{v}(t) = \lim_{t^{&#39;} \downarrow t} v(t^{&#39;}) - v(t)
\]</span> is called an <em>amended</em> volume at time <span class="math inline">\(t\)</span>.</p>
</div>

<p>It follows from definition <a href="methods.html#def:order">2.1</a> that <span class="math inline">\(T_1\)</span> is left-open, so <span class="math inline">\(a_v(t_{1,1}) = v_1 \neq 0\)</span>. This is the only place where we follow <span class="citation">(Bouchaud and Bonart 2018)</span> by modelling order placement as càglàd (continue à gauche, limite à droite) process:</p>
<blockquote>
<p>… we will consider the evolution of an LOB <span class="math inline">\(\mathcal{L}(t)\)</span> as a so-called <em>càglàd process (continu à gauche, limite à droite)</em>. Informally, this means that when a new order <span class="math inline">\(x\)</span> is submitted at time <span class="math inline">\(t_x\)</span> , we regard it to be present in the LOB immediately after its arrival, but not immediately upon its arrival.</p>
</blockquote>
<p>Then <span class="math inline">\(a_v(t) \neq 0\)</span> at some point <span class="math inline">\(t_{1,1} &lt; t &lt; t_{K,2}\)</span> implies that there is a left-open interval <span class="math inline">\(T_k\)</span> such that its left endpoint equals to <span class="math inline">\(t\)</span>.</p>
<p>Finally <span class="math inline">\(a_{v}(t_{K,2}) \neq 0\)</span> implies that <span class="math inline">\(T_K\)</span> is a right-closed, possibly degenerate, interval.</p>
<p>An order can be conveniently represented in the form of a order table defined by <a href="methods.html#def:order-table">2.7</a>.</p>

<div class="definition">
<p><span id="def:order-event" class="definition"><strong>Definition 2.6  (Order Event)  </strong></span>
An <em>order event</em> is a tuple <span class="math inline">\((t,s,p,v,m)\)</span> where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(t \in \mathbb{R}\)</span> is an <em>event timestamp</em></li>
<li><span class="math inline">\(s \in \{0, 1\}\)</span> is the <em>state</em> of the order after the event; <span class="math inline">\(s = 1\)</span> means the order is active; <span class="math inline">\(s = 0\)</span> means that order is done (finished) i.e. removed from an order book,</li>
<li><span class="math inline">\(p \in \mathbb{R}_{&gt;0}\)</span> is the <em>order price</em>,</li>
<li><span class="math inline">\(v \in \mathbb{R}\)</span> is the <em>order volume</em>,</li>
<li><span class="math inline">\(m \in \{0,1\}\)</span> is a <em>match indicator</em>; <span class="math inline">\(m =1\)</span> means that the order has been <em>matched</em> with another one and a trade has occurred between them so the event has been originated by the trade; <span class="math inline">\(m = 0\)</span> means that the event is an amendment and has not been originated by a trade.
</div></li>
</ol>

<div class="definition">
<p><span id="def:order-table" class="definition"><strong>Definition 2.7  (Order Table)  </strong></span>Suppose an order function <span class="math inline">\(o(p,t)\)</span> as defined by <a href="methods.html#def:order">2.1</a> is given. A set <span class="math display">\[\mathcal{E} = \{(t_k&#39;,s_k&#39;,p_k&#39;,v_k&#39;, m_k&#39;)\}_k\]</span> of <span class="math inline">\(K\)</span> or <span class="math inline">\(K+1\)</span> order events</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(\forall k \in \{1, \ldots, K\}\)</span> <span class="math inline">\(k\)</span>’s order event is defined as follows:
<ol style="list-style-type: decimal">
<li><span class="math inline">\(t_k&#39; = t_{k,1}, s_k&#39; = 1, p_k&#39; = p_k, v_k&#39; = v_k\)</span>,</li>
<li>if <span class="math inline">\(t_{k,1} \in T_k\)</span> then <span class="math inline">\(m_k&#39; = 1\)</span>, otherwise <span class="math inline">\(m_k&#39; = 0\)</span>,</li>
</ol></li>
<li><p>if <span class="math inline">\(T_K\)</span> is a finite interval, then <span class="math inline">\(K+1\)</span>’s order event is defined as follows:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(t_{K+1}&#39; = t_{K,2}, s_{K+1}&#39; = 0, p_{K+1}&#39;=p_K\)</span>,</li>
<li>if <span class="math inline">\(t_{K,2} \not \in T_K\)</span> then <span class="math inline">\(m_{K+1} = 1\)</span>,<span class="math inline">\(v_{K+1}&#39; = 0\)</span>; otherwise <span class="math inline">\(m_{K+1}&#39; = 0\)</span>, <span class="math inline">\(v_{K+1}&#39; = v_k\)</span></li>
</ol></li>
</ol>
<p>is called <em>an order table</em>. The index <span class="math inline">\(k\)</span> is called <em>an event ordinal number</em>.</p>
</div>


<div class="theorem">
<span id="thm:equivalence" class="theorem"><strong>Theorem 2.1  </strong></span>An order function <a href="methods.html#def:order">2.1</a> can be unambiguously restored from its order table <a href="methods.html#def:order-table">2.7</a>.
</div>


<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> Suppose the order table <span class="math inline">\(\mathcal{E} = \{(t_k&#39;,s_k&#39;,p_k&#39;,v_k&#39;, m_k&#39;)\}_{k=1}^{R}\)</span> is given. To restore the corresponding order function <span class="math inline">\(o(p,t)\)</span> as defined by <a href="methods.html#def:order">2.1</a> we need to restore <span class="math inline">\(\mathcal{T}\)</span>, <span class="math inline">\(\mathcal{P}\)</span> and <span class="math inline">\(\mathcal{V}\)</span> sets. It can be done as follows:</p>
<ol style="list-style-type: decimal">
<li><p>For all <span class="math inline">\(1 \leq k &lt; R\)</span></p>
<ol style="list-style-type: lower-alpha">
<li><p>The interval <span class="math inline">\(T_k\)</span> with left endpoint <span class="math inline">\(t_k&#39;\)</span> and right endpoint <span class="math inline">\(t_{k+1}&#39;\)</span> which is:</p>
<ul>
<li>a left-open if <span class="math inline">\(m_k&#39;=0\)</span> and left-closed if <span class="math inline">\(m_k&#39;=1\)</span></li>
<li>a right-open if <span class="math inline">\(m_{k+1}&#39;=1\)</span> and right-closed if <span class="math inline">\(m_{k+1}&#39;=0\)</span></li>
</ul>
<p>is added to <span class="math inline">\(\mathcal{T}\)</span></p></li>
<li>The interval <span class="math inline">\(P_k = \{p_k&#39;\}\)</span> is added to <span class="math inline">\(\mathcal{P}\)</span></li>
<li><p>The constant <span class="math inline">\(v_k&#39;\)</span> is added to <span class="math inline">\(\mathcal{V}\)</span></p></li>
</ol></li>
<li>If <span class="math inline">\(s_R&#39; = 1\)</span>:
<ol style="list-style-type: lower-alpha">
<li>The interval <span class="math inline">\(T_R\)</span> which is either <span class="math inline">\((t_R&#39;, +\infty)\)</span> if <span class="math inline">\(m_R&#39;=0\)</span> or <span class="math inline">\([t_{R}&#39;, +\infty)\)</span> if <span class="math inline">\(m_R&#39;=1\)</span> is added to <span class="math inline">\(\mathcal{T}\)</span>,</li>
<li>The interval <span class="math inline">\(P_R = \{p_R\}\)</span> is added to <span class="math inline">\(\mathcal{P}\)</span>,</li>
<li>The constant <span class="math inline">\(v_R&#39;\)</span> is added to <span class="math inline">\(\mathcal{V}\)</span>; note that <span class="math inline">\(v_R&#39; \neq 0\)</span>.</li>
</ol></li>
</ol>
</div>

<p>Note that <span class="math inline">\(|\mathcal{E}| = |\mathcal{T}| + 1\)</span> if the last interval <span class="math inline">\(T_k\)</span> is finite and <span class="math inline">\(|\mathcal{E}| = |\mathcal{T}|\)</span> otherwise, as in definition <a href="methods.html#def:order-table">2.7</a>.</p>
<p>See <a href="appendix.html#examples-of-order-tables-and-restored-functions">Appendix</a> for examples of order tables and order functions restored from them.</p>
<p>Typically the term <a href="https://www.investopedia.com/terms/o/order-book.asp">order book</a> refers to an electronic list of buy and sell orders for a specific security or financial instrument organized by price level. An order book lists the number of shares being bid on or offered at each price point, or market depth. Order books are used by almost every exchange to list the orders for different securities.</p>

<div class="definition">
<span id="def:order-set" class="definition"><strong>Definition 2.8  (Order Set)  </strong></span>A set of orders with common resolution parameters <span class="math inline">\(\tau\)</span>, <span class="math inline">\(\pi\)</span> and <span class="math inline">\(\phi\)</span> <span class="math display">\[\mathcal{O} = \{o^i(\cdot, \cdot)\}_i\]</span> where <span class="math inline">\(o^i(\cdot, \cdot)\)</span> is defined by <a href="methods.html#def:order">2.1</a> is called an <em>order set</em>.
</div>


<div class="definition">
<span id="def:bids" class="definition"><strong>Definition 2.9  (Bids)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O}\)</span> as defined by <a href="methods.html#def:order-set">2.8</a> is given. A (possibly empty) subset <span class="math inline">\(\mathcal{B} =\{o^b(\cdot, \cdot)\}_{v^b(\cdot) \geq 0} \subset \mathcal{O}\)</span> of buy orders is called <em>bids</em>. A (possibly empty) subset of <em>bids</em> <span class="math inline">\(\mathcal{B}(t) =\{o^b(\cdot,\cdot)\}_{v^b(t) \geq 0 \land p^b(t) &gt; 0} \subset \mathcal{B}\)</span> of buy orders is called <em>bids</em> at time <span class="math inline">\(t\)</span>.
</div>


<div class="definition">
<span id="def:asks" class="definition"><strong>Definition 2.10  (Asks)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O}\)</span> as defined by <a href="methods.html#def:order-set">2.8</a> is given. A (possibly empty) subset <span class="math inline">\(\mathcal{A} =\{o^a(\cdot, \cdot)\}_{v^a(\cdot) \leq 0} \subset \mathcal{O}\)</span> of sell orders is called <em>asks</em>. A (possibly empty) subset of <em>asks</em> <span class="math inline">\(\mathcal{A}(t) =\{o^a(\cdot,\cdot)\}_{v^a(t) \leq 0 \land p^a(t) &gt; 0} \subset \mathcal{A}\)</span> of sell orders is called <em>asks</em> at time <span class="math inline">\(t\)</span>.
</div>

<p>From definition of an order <a href="methods.html#def:order">2.1</a> follows that <span class="math inline">\(\mathcal{O} = \mathcal{A} \cup \mathcal{B}\)</span> and <span class="math inline">\(\mathcal{A} \cap \mathcal{B} = \emptyset\)</span>.</p>

<div class="definition">
<span id="def:best-bid-price" class="definition"><strong>Definition 2.11  (Best Bid Price)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O}\)</span> is given. The function <span class="math inline">\(b(t)\)</span> defined as:
<span class="math display">\[
  b_{\mathcal{O}}(t) = \begin{cases} \max_{o^b(\cdot,\cdot) \in \mathcal{B}(t)} p^b(t), &amp; \text{ if } \mathcal{B}(t) \neq \emptyset \\0, &amp; \text{ otherwise }  \end{cases}
  \]</span> is called <em>best bid price</em>.
</div>


<div class="definition">
<span id="def:best-ask-price" class="definition"><strong>Definition 2.12  (Best Ask Price)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O}\)</span> is given. The function <span class="math inline">\(a(t)\)</span> defined as:
<span class="math display">\[
  a_{\mathcal{O}}(t) = \begin{cases} \min_{o^a(\cdot,\cdot) \in \mathcal{A}(t)} p^a(t) &amp; \text{ if } \mathcal{A}(t) \neq \emptyset \\ +\infty, &amp; \text{ otherwise } \end{cases}
  \]</span> is called <em>best ask price</em>
</div>


<div class="definition">
<span id="def:spread" class="definition"><strong>Definition 2.13  (Spread)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O}\)</span> is given and <span class="math inline">\(a_{\mathcal{O}}(t)\)</span> and <span class="math inline">\(b_{\mathcal{O}}(t)\)</span> are its best ask price and best bid price functions as defined by <a href="methods.html#def:best-ask-price">2.12</a> and <a href="methods.html#def:best-bid-price">2.11</a> respectively. Then the function <span class="math display">\[
  s_{\mathcal{O}}(t) = a_{\mathcal{O}}(t) -  b_{\mathcal{O}}(t) 
  \]</span> is called <em>spread</em>.
</div>


<div class="definition">
<span id="def:lob" class="definition"><strong>Definition 2.14  (Limit Order Book)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{L}\)</span> as defined by <a href="methods.html#def:order-set">2.8</a> is given. Then <span class="math inline">\(\mathcal{L}\)</span> is called a <em>Limit Order Book (LOB)</em> if its spread function as defined by <a href="methods.html#def:spread">2.13</a> is always positive:
<span class="math display">\[ 
  \forall t: s_{\mathcal{L}}(t) &gt; 0
\]</span>
</div>

<p>A <a href="https://www.investopedia.com/terms/m/marketorder.asp">market order</a> is a request by an investor to buy or sell a security at the best available price at the time of order placement. The request is usually made through a broker or brokerage service and is ultimately executed by an exchange that maintains an order book. Clearly, a market order cause an exchange’s order book to be updated so market orders are modeled as <em>changes</em> of an order book.</p>

<div class="definition">
<p><span id="def:market-buy-order" class="definition"><strong>Definition 2.15  (Market Buy Order)  </strong></span>Suppose a Limit Order Book <span class="math inline">\(\mathcal{L}\)</span> is given as defined by <a href="methods.html#def:lob">2.14</a>. Suppose that at time <span class="math inline">\(t_j\)</span> <span class="math display">\[\sum_{o^a(\cdot, \cdot) \in \mathcal{A(t_j)} } f_{v^a}(t_j) &lt; 0 \]</span> Then it is said that a <em>market buy order</em> is placed and executed at time <span class="math inline">\(t_j\)</span> for <span class="math inline">\(\sum_{o^a(\cdot, \cdot) \in \mathcal{A}(t_j) } |f_{v^a}(t_j)p^a(t_j)|\)</span> units of currency.</p>
</div>


<div class="definition">
<p><span id="def:market-sell-order" class="definition"><strong>Definition 2.16  (Market Sell Order)  </strong></span>Suppose a Limit Order Book <span class="math inline">\(\mathcal{L}\)</span> is given as defined by <a href="methods.html#def:lob">2.14</a>. Suppose that at time <span class="math inline">\(t_j\)</span> <span class="math display">\[\sum_{o^b(\cdot, \cdot) \in \mathcal{B}(t_j) } f_{v^b}(t_j) &gt; 0 \]</span> Then it is said that a <em>market sell order</em> is placed and executed at time <span class="math inline">\(t_j\)</span> for <span class="math inline">\(\sum_{o^b(\cdot, \cdot) \in \mathcal{B}(t_j) } f_{v^b}(t_j)\)</span> units of asset.</p>
</div>

<p>To make the above definitions intuitively clear, consider an example in <a href="appendix.html#example-of-lob">Appendix</a>.</p>

<div class="definition">
<span id="def:order-set-table" class="definition"><strong>Definition 2.17  (Order Set Table)  </strong></span>Suppose an order set <span class="math inline">\(\mathcal{O} = \{ o^i(\cdot, \cdot) \}_i\)</span> as defined by <a href="methods.html#def:order-set">2.8</a> is given. A union of set of tuples:
<span class="math display">\[\mathcal{S} = \bigcup_i \big\{(i, k, t_k^i, s_k^i,p_k^i, v_k^i, m_k^i)\big\}_{k=1}^{K^i}\]</span> where <span class="math inline">\(i\)</span> is <em>a unique order identification number</em> and <span class="math inline">\(\{(t_k^i, s_k^i,p_k^i, v_k^i, m_k^i)\}_{k=1}^{K^i}\)</span> is the order table as defined by <a href="methods.html#def:order-table">2.7</a> of order <span class="math inline">\(o^i(\cdot, \cdot)\)</span> is called <em>an order set table</em>. Each tuple in the order set table is called <em>an order event with order id</em>.
</div>

</div>
<div id="stripe-and-dot" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Stripe and Dot</h3>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:transmute-example-1">
<caption style="caption-side: top; text-align: center;"><span id="tab:transmute-example-1">Table 2.1: </span> In spite of being very short Order Set Table shown is hard to understand</caption><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(i\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(t^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(s^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(p^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(v^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(m^i_k\)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.9</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">530</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.4</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">530</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
</table>

<div class="figure" style="text-align: center"><span id="fig:transmute-example-1-picture"></span>
<img src="transmute_example_1.png" alt="It is easier to comprehend a visual representation of Order Set Table \@ref(tab:transmute-example-1)"  />
<p class="caption">
Figure 2.1: It is easier to comprehend a visual representation of Order Set Table <a href="methods.html#tab:transmute-example-1">2.1</a>
</p>
</div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:transmute-example-2">
<caption style="caption-side: top; text-align: center;"><span id="tab:transmute-example-2">Table 2.2: </span> Order 4 with two events has been added to Order Set Table</caption><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(i\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(t^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(s^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(p^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(v^i_k\)</th><th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">\(m^i_k\)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.9</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">530</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.4</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">2021-03-26 13:59:06.5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">-1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:06.7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">535</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2021-03-26 13:59:07.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">530</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">2021-03-26 13:59:07.2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">540</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">-1&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(190, 190, 190); font-weight: normal;">0</td></tr>
</table>

<div class="figure" style="text-align: center"><span id="fig:transmute-example-2-picture"></span>
<img src="transmute_example_2.png" alt="A visual representation of Order Book Set \@ref(tab:transmute-example-2) is distorted since orders 3 and 4 overlaps"  />
<p class="caption">
Figure 2.2: A visual representation of Order Book Set <a href="methods.html#tab:transmute-example-2">2.2</a> is distorted since orders 3 and 4 overlaps
</p>
</div>
</div>
</div>
<div id="software" class="section level2">
<h2><span class="header-section-number">2.2</span> Software</h2>
<div id="capture-order-events" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Capture order events</h3>
<p>Figure <a href="methods.html#fig:capture-overview">2.3</a> shows UML2 Activity Diagram <span class="citation">(Cook et al. 2017)</span> of <code>S.1 Capture</code> activity that represents an implementation of <code>oberon capture</code> command. The activity node <code>Reconstruct Order Book</code> performs a reconstruction of order book events from exchange-specific messages that are passed by node <code>Receive messages</code>.</p>
<div class="figure" style="text-align: left"><span id="fig:capture-overview"></span>
<img src="Standalone%20application%20-%20capture.png" alt="`Receive messages` activity node collects avaialbe information in an exchange-specific format and pass the information in the form of [Boost.Property Tree](https://www.boost.org/doc/libs/1_73_0/doc/html/property_tree.html) to `Reconstruct Order Book` activity node that, as its name implies, reconstructs order book events in an *universal* format described herein. Note that both activity nodes run concurrently."  />
<p class="caption">
Figure 2.3: <code>Receive messages</code> activity node collects avaialbe information in an exchange-specific format and pass the information in the form of <a href="https://www.boost.org/doc/libs/1_73_0/doc/html/property_tree.html">Boost.Property Tree</a> to <code>Reconstruct Order Book</code> activity node that, as its name implies, reconstructs order book events in an <em>universal</em> format described herein. Note that both activity nodes run concurrently.
</p>
</div>
<div id="receive-messages" class="section level4">
<h4><span class="header-section-number">2.2.1.1</span> Receive messages</h4>
<p>Activity <code>Receive messages</code> on figure <a href="methods.html#fig:capture-overview">2.3</a> is UML2 <code>StartObjectBehaviourAction</code> that starts execution of <code>Receiver</code> StateMachine shown on figure <a href="methods.html#fig:receiver">2.4</a>. The call is synchronous, so the execution of the <code>Receive messages</code> does not complete until the execution of <code>Receiver</code> StateMachine completes.</p>

<div class="figure" style="text-align: left"><span id="fig:receiver"></span>
<img src="Receiver%20state%20machine.png" alt="Processing snapshot and Processing messages states pass received portions of data to Reconstruct Order Book (by calling method Reconstructor::process() shown on figure 2.8) thereby the streaming of data between Receive messages and Reconstruct Order Book on figure 2.3 is implemented."  />
<p class="caption">
Figure 2.4: <code>Processing snapshot</code> and <code>Processing messages</code> states pass received portions of data to <code>Reconstruct Order Book</code> (by calling method <code>Reconstructor::process()</code> shown on figure <a href="methods.html#fig:sd-reconstructor-process">2.8</a>) thereby the streaming of data between <code>Receive messages</code> and <code>Reconstruct Order Book</code> on figure <a href="methods.html#fig:capture-overview">2.3</a> is implemented.
</p>
</div>
<p>Almost all exchanges provide two separate channels for receiving (i) a list of orders currently open on order book and (ii) order updates. In order to capture a dynamics of an order book one need to receive information from both channels and combine it. <code>Feeder</code> StateMachine shown on figure <a href="methods.html#fig:feeder">2.5</a> deals with receiving order updates while <code>Snapshot</code> StateMachine shown on figure <a href="methods.html#fig:snapshot">2.6</a> is responsible for getting a list of orders currently open on order book.</p>
<p>Now look at figure <a href="methods.html#fig:receiver">2.4</a> again. An entry behaviour of <code>Engage.Engaging Feeder</code> state launches <code>Feeder</code> StateMachine asynchronously. The latter sends “success” event as soon as it successfully subscribed for order updates and <code>Receiver</code> transitions to <code>Engage.Feeder Engaged.Making Snapshot.Obtaining</code> state. The state’s entry behaviour asynchronously launches <code>Snapshot</code> StateMachine shown on figure <a href="methods.html#fig:snapshot">2.6</a>.</p>
<p>While <code>Receiver</code> remains in <code>Engaged.Feeder Engaged.Making Snapshot</code> state messages sent by <code>Feeder</code> are queued by internal transition activity on <code>Receiver.Feeder Engaged</code> state. As soon as <code>Snapshot</code> has received the snapshot, it sends <code>Receiver</code> “success” event and <code>Receiver</code> checks whether the snapshot and messages from <code>Feeder</code> cover the intersecting time periods or the snapshot is stale. In the latter case the snapshot is re-queried. Otherwise <code>Receiver</code> transitions to <code>Processing snapshot</code> state which asynchronously passes the snapshot to <code>Reconstruct Order Book</code> activity and upon receiveing “success” event transitions to <code>Processing messages</code> which asynchronously passes messages received from an exchange to <code>Reconstruct Order Book</code>. It is assumed that <code>Receiver</code> spends most of the time in this state.</p>

<div class="figure" style="text-align: left"><span id="fig:feeder"></span>
<img src="Feeder%20state%20machine.png" alt="Transition success between Subscribe and Receive states sends “success” event to Receiver StateMachine. An entry behaviour of Receive state launches asynchronous read operation, whose successfull completion triggers success transition from Receive. If some service message (i.e. heartbeat, subscription) has arrived, it is processed locally. Otherwise “message” event is sent to Receiver."  />
<p class="caption">
Figure 2.5: Transition <code>success</code> between <code>Subscribe</code> and <code>Receive</code> states sends “success” event to <code>Receiver</code> StateMachine. An entry behaviour of <code>Receive</code> state launches asynchronous read operation, whose successfull completion triggers <code>success</code> transition from <code>Receive</code>. If some service message (i.e. heartbeat, subscription) has arrived, it is processed locally. Otherwise “message” event is sent to <code>Receiver</code>.
</p>
</div>

<div class="figure" style="text-align: left"><span id="fig:snapshot"></span>
<img src="Snapshot%20state%20machine.png" alt="Snapshot StateMachine diagram."  />
<p class="caption">
Figure 2.6: Snapshot StateMachine diagram.
</p>
</div>
</div>
<div id="reconstruct-order-book" class="section level4">
<h4><span class="header-section-number">2.2.1.2</span> Reconstruct Order Book</h4>
<p>Figure <a href="methods.html#fig:reconstruct-order-book">2.7</a> shows UML2 Activity Diagram of <code>Reconstruct Order Book</code> activity which is called by the activity node with the same name on figure <a href="methods.html#fig:capture-overview">2.3</a>.</p>
<div class="figure" style="text-align: left"><span id="fig:reconstruct-order-book"></span>
<img src="Reconstruct%20Order%20Book.png" alt="`Reconstruct Order Book` activity is implemented by an indefinite loop that invokes `Process message` activity every time new instance is placed on its input pin `ptree`. The loop terminates if `Process message` throws `processing_error` exception."  />
<p class="caption">
Figure 2.7: <code>Reconstruct Order Book</code> activity is implemented by an indefinite loop that invokes <code>Process message</code> activity every time new instance is placed on its input pin <code>ptree</code>. The loop terminates if <code>Process message</code> throws <code>processing_error</code> exception.
</p>
</div>
<p>The activity node <code>Process message</code> on figure <a href="methods.html#fig:reconstruct-order-book">2.7</a> is Call Action. It calls method <code>Reconstructor::process()</code> on <code>target</code> instance. UML2 Sequence diagram on figure <a href="methods.html#fig:sd-reconstructor-process">2.8</a> shows a “happy path” trace of the method.</p>
<div class="figure" style="text-align: left"><span id="fig:sd-reconstructor-process"></span>
<img src="sd%20Reconstructor%20-%20process.png" alt="`Reconstructor::process()` first calls virtual abstract `extract()` method to create an instance of a class derived from `Message`. The `extract()` method is abstract and overriden by an exchange-specific implementation class, derived from `Reconstructor`. The returned instance is passed to a chain of `TokenHandler`'s through the call of `handle()`"  />
<p class="caption">
Figure 2.8: <code>Reconstructor::process()</code> first calls virtual abstract <code>extract()</code> method to create an instance of a class derived from <code>Message</code>. The <code>extract()</code> method is abstract and overriden by an exchange-specific implementation class, derived from <code>Reconstructor</code>. The returned instance is passed to a chain of <code>TokenHandler</code>’s through the call of <code>handle()</code>
</p>
</div>
<p>The virtual method <code>Reconstructor::extract()</code> takes a <a href="https://www.boost.org/doc/libs/1_73_0/doc/html/property_tree.html">Boost.PropertyTree</a> container with an exchange-specific data and creates an instance of one of internal exchange-independent message class shown in green on figure <a href="methods.html#fig:message-hierarchy-process">2.9</a>. The message is returned in <code>Token</code> container.</p>
<div class="figure" style="text-align: center"><span id="fig:message-hierarchy-process"></span>
<img src="Message%20hierarchy%20for%20process.png" alt="`Message`-based hierarchy of classes used in implementation of `Process message` activity. A message of class `Era` carries information about exchange and product being processed."  />
<p class="caption">
Figure 2.9: <code>Message</code>-based hierarchy of classes used in implementation of <code>Process message</code> activity. A message of class <code>Era</code> carries information about exchange and product being processed.
</p>
</div>
<p>As shown on figure <a href="methods.html#fig:reconstructor-hierarchy-process">2.10</a> <code>Reconstructor::extract()</code> method is <em>abstract</em>, so it is overriden by exchange-specific versions that able to process their respective containers properly.</p>
<div class="figure" style="text-align: center"><span id="fig:reconstructor-hierarchy-process"></span>
<img src="Reconstructor%20hierarchy%20for%20process.png" alt="&quot;Reconstructor&quot; hierarchy of classes used in implementation of &quot;Process message&quot; activity."  />
<p class="caption">
Figure 2.10: “Reconstructor” hierarchy of classes used in implementation of “Process message” activity.
</p>
</div>
<p><code>Token</code> that carries an instance of a class derived from <code>Message</code> is then taken by the <code>TokenHandle::handle()</code> (<code>Reconstructor</code> is derived from <code>TokenHandler</code>) that is the first step of so called <em>data cleansing</em>. According to <span class="citation">(Rahm and Do 2000)</span>:</p>
<blockquote>
<p><em>Data cleaning</em>, also called <em>data cleansing</em> or <em>scrubbing</em>, deals with detecting and removing errors and inconsistencies from data in order to improve the quality of data.</p>
</blockquote>
<p>Data cleansing is implemented using <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">Chain of Responsibility</a> pattern. Each <code>TokenHandler</code> accepts, as a constructor parameter, the next <code>TokenHandler</code> which will receive messages as soon as <code>TokenHandler</code> being constructed has handled them.</p>
<p>UML2 Sequence Diagram of <code>TokenHandler::handle()</code> is shown on figure <a href="methods.html#fig:sd-tokenhandler-handle">2.11</a>. The number of <code>TokenHandler</code>s involved and their kinds depend on an exchange and described in details in their respective sections later.</p>
<div class="figure" style="text-align: center"><span id="fig:sd-tokenhandler-handle"></span>
<img src="sd%20TokenHandler%20-%20handle.png" alt="UML2 Sequence diagram showing a &quot;happy path&quot; trace of TokenHandler::handle() method"  />
<p class="caption">
Figure 2.11: UML2 Sequence diagram showing a “happy path” trace of TokenHandler::handle() method
</p>
</div>
<p>Handling of messages by <code>TokenHandler</code> is denoted by interaction use <code>Message - accept</code> on figure <a href="methods.html#fig:sd-tokenhandler-handle">2.11</a>. The result of handling is a set of zero or more messages that are stored in <code>output_</code> member variable that is an instance of <code>Tokens</code> class shown on figure <a href="methods.html#fig:tokens">2.12</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:tokens"></span>
<img src="Tokens.png" alt="Definition of &quot;Tokens&quot;."  />
<p class="caption">
Figure 2.12: Definition of “Tokens”.
</p>
</div>
<p><code>TokenHandler</code> will not produce output for a message when subsequent messages are required for handling(cleansing). In this case the message will be kept within this particular <code>TokenHandler</code> instance between runs of <code>Reconstructor::process()</code> until enough subsequent messages are received. Then all kept and cleansed messages are returned together, saved into <code>output_</code> variable and passed one by one in FIFO order to the <code>this.next_</code> <code>TokenHandler</code>. After that <code>output_</code> variables is cleared, so if there is no next <code>TokenHandler</code> the messages are deleted after being accepted.</p>
<p>Handling of messages by <code>TokenHandler</code> is implemented using <a href="https://en.wikipedia.org/wiki/Visitor_pattern">Visitor</a> pattern as shown by UML2 Sequence diagram on figure <a href="methods.html#fig:sd-message-accept">2.13</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:sd-message-accept"></span>
<img src="sd%20Message%20-%20accept.png" alt="UML2 Sequence diagram showing various alternatives of traces for Message::accept() method"  />
<p class="caption">
Figure 2.13: UML2 Sequence diagram showing various alternatives of traces for <a href="Message::accept" class="uri">Message::accept</a>() method
</p>
</div>
<p>It should be clear from the definition of order table <a href="methods.html#def:order-table">2.7</a> that not every set of order events as defined by <a href="methods.html#def:order-event">2.6</a> represents a valid order table. Similarly, not every set of orders represents valid LOB as defined by <a href="methods.html#def:lob">2.14</a>.</p>
<p>Data cleansing process receives a stream of order events (possible extended and/or incomplete i.e. order events as defined by <a href="methods.html#def:order-event">2.6</a> but with some additional and/or missing attributes), restores order functions from them and then restores LOB from order functions.</p>
<p>Data cleansing is performed by a sequence of <code>TokenHandler</code>s as shown on figure <a href="methods.html#fig:sd-tokenhandler-handle">2.11</a>. Table <a href="methods.html#tab:tokenhandler-chains">2.3</a> below lists <code>TokenHandler</code>s used for different exchange event streams.</p>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:tokenhandler-chains">
<caption style="caption-side: top; text-align: left;"><span id="tab:tokenhandler-chains">Table 2.3: </span> Y means that TokenHandler (left) is used by the exchange chain (top), N - is not used and C means that a customized version is used.</caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><span style="color: rgb(255, 255, 255);">TokenHandler</span></th><th style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Coinbase</th><th style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Bitstamp</th><th style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Bitfinex</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Synchronizer</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">TimeOrderEnforcer</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Deduplicator</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">C</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">SizeDeducer</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">EventCounter</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">File</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td><td style="vertical-align: top; text-align: center; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Y</td></tr>
</table>

</div>
<div id="save-output" class="section level4">
<h4><span class="header-section-number">2.2.1.3</span> Save output</h4>
<p>The last TokenHandler in every chain is <code>File</code> that outputs the cleansed events. Upon receving a message of class <code>Era</code> (see figure <a href="methods.html#fig:message-hierarchy-process">2.9</a>) <code>File</code> opens a new file called <em>Era file</em> and saves the subsequent <code>OrderEvent</code> messages there until obtaining <code>Reset</code> message when the handler closes Era file. <code>File</code> drops <code>Elapsed</code> messages silently.</p>
<p>Era file is <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV-file</a> with one row per <code>OrderEvent</code> and name constructed from exchange, product and timestamp values carried by <code>Era</code> message. Row fields are described in the table <a href="methods.html#tab:order-record">2.4</a> below.</p>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:order-record">
<caption style="caption-side: top; text-align: left;">
<span id="tab:order-record">Table 2.4: </span> Era file fields and their corresponding elements of order event with order id tuple as defined by <a href="methods.html#def:order-set-table">2.17</a>. If the value of a field can not be determined, it is reported as NA. UUIDs may be shorter than 32 hexadecimal digits; in this case it is assumed to be padded by zeros from the left.
</caption>
<col>
<col>
<col>
<col>
<col>
<tr>
<th style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
#
</th>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Field
</th>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Type
</th>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Description
</th>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Element
</th>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
1
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
maker
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<a href="https://www.boost.org/doc/libs/1_67_0/libs/uuid/doc/uuid.html#boost/uuid/string_generator.hpp">UUID</a>
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
an unique identification number of the order open on the order book
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
2
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
ordinal
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
long
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
A sequential number of the event for this order
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(k\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
3
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
timestamp
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
string
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Time the event occurred, in <a href="https://tools.ietf.org/html/rfc3339#page-10">ISO 8601</a> format, up to a second. Empty field means that the value is the same as in the previous event (previous row)
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(t_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
4
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
mks
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
int
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Microseconds part of the time the event occurred, if different from zero; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(t_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
5
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
timestamp_change
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
long long
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Microseconds passed since the previous event, i.e. <span class="math inline">\(t_k^i - t_{k-1}^i\)</span> if <span class="math inline">\(k\)</span> is greater than 1 and <span class="math inline">\(t_k^i \neq t_{k-1}^i\)</span>; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
6
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
state
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
bool
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
1, if the order is open on the order book after the event; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(s_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
7
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
price
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
double
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Price of the order
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(p_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
8
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
price_change
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
double
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Price change since the previous event, i.e. <span class="math inline">\(p_k^i - p_{k-1}^i\)</span> if <span class="math inline">\(k\)</span> is greater than 1 and <span class="math inline">\(p_k^i \neq p_{k-1}^i\)</span>; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
9
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
volume
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
double
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Volume of the order if different from zero; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(v_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
10
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
volume_change
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
double
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Change of the order’s volume since the previous event, i.e. <span class="math inline">\(v_k^i - v_{k-1}^i\)</span> if <span class="math inline">\(k\)</span> is greater than 1 and <span class="math inline">\(v_k^i \neq v_{k-1}^i\)</span>; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
11
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
trade
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
long long
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
If the event is originated by a trade it is an unique trade identification number; otherwise emtpy. Thus <span class="math inline">\(m_k^i \equiv\)</span> trade isn’t empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
<span class="math inline">\(m_k^i\)</span>
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
12
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
taker
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
UUID
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
If the event is originated by a trade, it is an unique identification number of the matched taker order; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
13
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
heard
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
int
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
Microseconds passed since the event occurred on the exchange till the application heard about it, if the event occured on the exchange; otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
14
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: bold;">
deleted
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
bool
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
1, if the event’s been deleted (for example, it is a duplicate event); otherwise empty
</td>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">
</td>
</tr>
</table>
</div>
</div>
<div id="slice-and-merge-era-files" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Slice and merge era files</h3>
<p>TBD</p>
</div>
<div id="transmute" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Transmute</h3>
<p>TBD</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
